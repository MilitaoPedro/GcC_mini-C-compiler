# Nome do seu workflow. Aparecerá na aba "Actions" do GitHub.
name: Compilador CI

# Define quando o workflow deve rodar.
on:
  # Roda em qualquer push para qualquer branch
  push:
    branches: [ "**" ]
  # Roda em qualquer pull request para a branch 'main'
  pull_request:
    branches: [ "main" ]

# Define os "trabalhos" (jobs) que o workflow vai executar.
jobs:
  # Nosso único trabalho é o 'build'
  build:
    # Rodar em uma máquina virtual Ubuntu (padrão do Codespaces)
    runs-on: ubuntu-latest

    # Define os passos sequenciais do trabalho
    steps:
      # 1. Baixa o código do seu repositório para a máquina virtual
      - name: Checkout do Repositório
        uses: actions/checkout@v4

      # 2. Instala as dependências (FLEX, BISON, libfl e Graphviz)
      - name: Instalar Dependências (flex, bison, libfl-dev, graphviz)
        run: |
          sudo apt-get update
          # Instala o flex, o bison, a biblioteca de desenvolvimento do flex (-lfl)
          # E o graphviz (que provê o comando 'dot' para gerar o SVG)
          sudo apt-get install -y flex bison libfl-dev graphviz

      # 3. Compila o projeto usando o Makefile
      - name: Compilar o Projeto
        run: make
        # O 'make' por padrão executa a regra 'all' do seu Makefile,
        # que agora roda o bison, depois o flex, o gcc E o dot.

      # 4. (Opcional, mas recomendado) Fazer um "Teste de Fumaça"
      #    Isso garante que o executável foi criado e não falha imediatamente.
      - name: Executar Teste de Fumaça (Smoke Test)
        run: |
          # Executa o compilador. Se ele falhar (retornar != 0), o workflow falha.
          src/compilador ./tests/teste_semantico_valido.txt